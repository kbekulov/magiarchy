<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Timeline</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>    
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #f5f5f5;
        }
        .timeline-container {
            overflow-x: hidden;
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(to right, #1e1e1e 50%, #252525 50%);
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            background: #1e1e1e;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 2px solid #333;
        }
        .color-box {
            width: 16px;
            height: 16px;
            display: inline-block;
            margin-right: 5px;
            border-radius: 4px;
        }
        .timeline {
            display: flex;
            overflow-x: auto;
            flex: 1;
            padding: 20px;
            cursor: grab;
        }
        .timeline:active {
            cursor: grabbing;
        }
        .act {
            min-width: 600px;
            margin-right: 20px;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        .act h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #f5f5f5;
        }
        .timeline-item {
            margin-bottom: 15px;
            background: #1e1e1e;
            color: #f5f5f5;
            border-radius: 8px;
            position: relative;
            padding: 8px 12px;
            transition: transform 0.3s;
        }
        .timeline-item:hover {
            transform: scale(1.03);
            background: #333;
        }
        .tooltip {
            position: absolute;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            background: #f5f5f5;
            color: #121212;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
        }
        .timeline-item:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }
        .group-ratio {
            text-align: center;
            margin: 20px 0;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const { useState, useEffect } = React;

        const colors = [
            { className: "bg-group-1", color: "#6A5ACD" },
            { className: "bg-group-2", color: "#4682B4" },
            { className: "bg-group-3", color: "#8B4513" },
            { className: "bg-group-4", color: "#5F9EA0" },
            { className: "bg-group-5", color: "#2E8B57" }
        ];

        const fetchData = async () => {
            // Simulated data fetch
            return [
                {
                    act: "I",
                    events: [
                        {
                            groupName: "Group 1",
                            content: "Event 1 in Act I. A detailed explanation of the event.",
                            tooltip: "Tooltip for Event 1 in Act I",
                        },
                        {
                            groupName: "Group 2",
                            content: "Event 2 in Act I. Another description of events.",
                            tooltip: "Tooltip for Event 2 in Act I",
                        }
                    ]
                },
                {
                    act: "II",
                    events: [
                        {
                            groupName: "Group 1",
                            content: "Event 1 in Act II. A pivotal event.",
                            tooltip: "Tooltip for Event 1 in Act II",
                        },
                        {
                            groupName: "Group 3",
                            content: "Event 2 in Act II. Further intrigue.",
                            tooltip: "Tooltip for Event 2 in Act II",
                        }
                    ]
                }
            ];
        };

        const App = () => {
            const [data, setData] = useState([]);
            const [groupCounts, setGroupCounts] = useState({});

            useEffect(() => {
                const loadData = async () => {
                    const fetchedData = await fetchData();
                    setData(fetchedData);

                    // Calculate group counts
                    const counts = {};
                    fetchedData.forEach(({ events }) => {
                        events.forEach(({ groupName }) => {
                            counts[groupName] = (counts[groupName] || 0) + 1;
                        });
                    });
                    setGroupCounts(counts);
                };
                loadData();
            }, []);

            const calculateRatios = () => {
                const total = Object.values(groupCounts).reduce((sum, count) => sum + count, 0);
                return Object.entries(groupCounts).map(([group, count]) => ({
                    group,
                    ratio: ((count / total) * 100).toFixed(1)
                }));
            };

            return (
                <div className="timeline-container">
                    <div className="legend">
                        {Object.keys(groupCounts).map((groupName, index) => (
                            <div key={groupName}>
                                <span
                                    className="color-box"
                                    style={{ backgroundColor: colors[index % colors.length].color }}
                                ></span>
                                {groupName}
                            </div>
                        ))}
                    </div>

                    <div className="timeline">
                        {data.map((act) => (
                            <div key={act.act} className="act">
                                <h3>{`Act ${act.act}`}</h3>
                                {act.events.map((event, index) => (
                                    <div
                                        key={index}
                                        className="timeline-item"
                                        style={{
                                            borderLeft: `6px solid ${colors[index % colors.length].color}`
                                        }}
                                    >
                                        {event.content}
                                        <div className="tooltip">{event.tooltip}</div>
                                    </div>
                                ))}
                            </div>
                        ))}
                    </div>

                    <div className="group-ratio">
                        {calculateRatios().map(({ group, ratio }) => (
                            <span
                                key={group}
                                style={{
                                    color: colors[Object.keys(groupCounts).indexOf(group) % colors.length].color,
                                    marginRight: "10px"
                                }}
                            >
                                {`${group} (${ratio}%)`}
                            </span>
                        ))}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById("app"));
    </script>
</body>
</html>
